{% extends 'base.html' %}

{% block content %}
<div class="container mt-5 pt-5">
    <h1 class="mb-4">Последние новости</h1>
    <!-- Сетка новостей -->
    <div class="row">
        <div class="col-12">
            {% if news %}
            <div class="row">
                {% for item in news %}
                <div class="col-md-6 col-lg-4 mb-4" data-aos="fade-up" data-aos-delay="{% widthratio forloop.counter0 1 50 %}" data-aos-duration="800">
                    <div class="card h-100 shadow-sm news-card">
                        <!-- Изображение новости -->
                        {% if item.main_image %}
                        <img src="{{ item.main_image }}" class="card-img-top" alt="{{ item.title }}"
                             style="height: 200px; object-fit: cover;">
                        {% else %}
                        <div class="card-img-top d-flex align-items-center justify-content-center"
                             style="height: 200px;">
                            <i class="bi bi-newspaper" style="font-size: 3rem;"></i>
                        </div>
                        {% endif %}

                        <div class="card-body d-flex flex-column">
                            <!-- Заголовок -->
                            <h5 class="card-title fw-bold">{{ item.title }}</h5>

                            <!-- Дата -->
                            <div class="mb-2">
                                <small>
                                    <i class="bi bi-calendar me-1"></i>{{ item.date }}
                                </small>
                            </div>

                            <!-- Текст новости -->
                            <p class="card-text flex-grow-1">{{ item.text|truncatewords:30 }}</p>

                            <!-- Дополнительные изображения (если есть) -->
                            {% if item.additional_images %}
                            <div class="mb-3">
                                <small>
                                    <i class="bi bi-images me-1"></i>
                                    Ещё {{ item.additional_images|length }} изображений
                                </small>
                            </div>
                            {% endif %}

                            <!-- Кнопка подробнее -->
                            <div class="mt-auto">
                                <a href="{% url 'news_detail' item.id %}" class="btn btn-primary w-100">
                                    <i class="bi bi-eye me-2"></i>Подробнее
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <!-- Сообщение если нет новостей -->
            <div class="text-center py-5" data-aos="fade-up" data-aos-duration="800">
                <div class="card shadow-sm">
                    <div class="card-body py-5">
                        <i class="bi bi-inbox display-1"></i>
                        <h3 class="mt-3">Новостей пока нет</h3>
                        <p>Запустите парсинг, чтобы получить актуальные новости</p>
                        <form method="post" action="{% url 'run_parser' %}" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-download me-2"></i>Запустить парсинг
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Пагинация -->
    {% if news.has_other_pages %}
    <div class="row mt-5">
        <div class="col-12">
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    {% if news.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ news.previous_page_number }}">Назад</a>
                    </li>
                    {% endif %}

                    {% for num in news.paginator.page_range %}
                    <li class="page-item {% if news.number == num %}active{% endif %}">
                        <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                    </li>
                    {% endfor %}

                    {% if news.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ news.next_page_number }}">Вперед</a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </div>
    {% endif %}
</div>

<!-- Подключение библиотеки AOS для анимаций -->
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

<style>
    .container.mt-5.pt-5 {
        margin-top: 4rem !important;
        padding-top: 3rem !important;
    }

    .news-card {
        border: none;
        border-radius: 15px;
        transition: all 0.3s ease;
        overflow: hidden;
        background: var(--card-bg);
        color: var(--card-text);
        border: 1px solid var(--border-color);
    }

    .news-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1) !important;
    }

    .card-img-top {
        border-radius: 15px 15px 0 0;
    }

    .card-body {
        padding: 1.5rem;
    }

    .card-title {
        font-size: 1.1rem;
        line-height: 1.4;
        min-height: 3rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .card-text {
        line-height: 1.6;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .btn-primary {
        background: linear-gradient(45deg, var(--btn-primary-bg), var(--btn-primary-hover));
        border: none;
        border-radius: 10px;
        padding: 0.75rem 1.5rem;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .btn-primary:hover {
        background: linear-gradient(45deg, var(--btn-primary-hover), #004085);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
    }

    .shadow-sm {
        box-shadow: 0 2px 10px rgba(0,0,0,0.08) !important;
    }

    .page-link {
        background: var(--card-bg);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
    }

    .page-item.active .page-link {
        background: linear-gradient(45deg, var(--btn-primary-bg), var(--btn-primary-hover));
        border-color: var(--btn-primary-bg);
    }

    [data-aos] {
        pointer-events: none;
    }
    .aos-animate {
        pointer-events: auto;
    }

    @media (max-width: 768px) {
        .container.mt-5.pt-5 {
            margin-top: 3rem !important;
            padding-top: 2rem !important;
        }
    }

    @media (max-width: 576px) {
        .container.mt-5.pt-5 {
            margin-top: 2rem !important;
            padding-top: 1.5rem !important;
        }
    }
</style>

<script>
    // Инициализация AOS (Animate On Scroll)
    document.addEventListener('DOMContentLoaded', function() {
        AOS.init({
            disable: false,
            startEvent: 'DOMContentLoaded',
            initClassName: 'aos-init',
            animatedClassName: 'aos-animate',
            useClassNames: false,
            disableMutationObserver: false,
            debounceDelay: 50,
            throttleDelay: 99,
            offset: 120,
            delay: 0,
            duration: 400,
            easing: 'ease',
            once: true,
            mirror: false,
            anchorPlacement: 'top-bottom',
        });

        // Инициализация tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>
{% endblock %}